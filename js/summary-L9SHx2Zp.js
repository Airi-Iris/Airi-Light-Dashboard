import{d as c,aF as S,aG as b,bd as A,a2 as R,bk as B,bl as C,aI as N,bm as $,aQ as P,bn as j,bo as x,W as D,e,F as g,f as T,g as s,b as h,bp as I,H as w,i as q,M as z,av as k,P as L,bq as V,br as H,L as O,B as p,R as f,s as E,U as M,l as G,bs as U,x as W}from"./index-DYGX83NG.js";import{u as _}from"./index-CxJKFq8y.js";import{T as K}from"./Trash-BJj_4BXG.js";import{a as Q,N as J}from"./ListItem-BSICn9GG.js";const X=Object.assign(Object.assign({},b.props),{align:String,justify:{type:String,default:"start"},inline:Boolean,vertical:Boolean,reverse:Boolean,size:{type:[String,Number,Array],default:"medium"},wrap:{type:Boolean,default:!0}}),Y=c({name:"Flex",props:X,setup(a){const{mergedClsPrefixRef:t,mergedRtlRef:r}=S(a),n=b("Flex","-flex",void 0,$,a,t);return{rtlEnabled:A("Flex",r,t),mergedClsPrefix:t,margin:R(()=>{const{size:l}=a;if(Array.isArray(l))return{horizontal:l[0],vertical:l[1]};if(typeof l=="number")return{horizontal:l,vertical:l};const{self:{[P("gap",l)]:i}}=n.value,{row:d,col:o}=j(i);return{horizontal:x(o),vertical:x(d)}})}},render(){const{vertical:a,reverse:t,align:r,inline:n,justify:u,margin:l,wrap:i,mergedClsPrefix:d,rtlEnabled:o}=this,m=B(C(this),!1);return m.length?N("div",{role:"none",class:[`${d}-flex`,o&&`${d}-flex--rtl`],style:{display:n?"inline-flex":"flex",flexDirection:a&&!t?"column":a&&t?"column-reverse":!a&&t?"row-reverse":"row",justifyContent:u,flexWrap:!i||a?"nowrap":"wrap",alignItems:r,gap:`${l.vertical}px ${l.horizontal}px`}},m):null}});function Z(a){return typeof a=="function"||Object.prototype.toString.call(a)==="[object Object]"&&!W(a)}const se=c({setup(){const a=D();return()=>{const t=a.query.refId;return e(g,null,[e("div",{class:"relative"},[e(g,null,[e("div",{class:T("flex flex-wrap items-center justify-between pt-4 lg:mb-5")},[e("div",{class:"flex items-center justify-between"},[e("p",{class:"flex items-center text-lg font-medium"},[t?e("span",{class:"inline-flex center"},[s("AI · 生成摘要"),e("div",{class:"text-sm text-zinc-900/80 ml-4"},[s("目标ID"),">",s("["),t,s("]")])]):e("span",null,[s("AI · 摘要")])])])]),t?e("div",{class:"p-16 pt-0"},[e(te,{refId:t},null)]):e("div",{class:"p-16 pt-0"},[e(ee,null,null)])])])])}}}),ee=c({setup(){const a=h(1),{data:t,mutate:r}=I("/api/ai/summaries",async()=>await f.api.ai.summaries.get({params:{page:a.value}}),{revalidateOnFocus:!1});return()=>t.value?.data.length===0?e(w,null,null):e(g,null,[e(F,{summaries:t.value?.data||[],getArticle:n=>{const u=t.value?.articles[n];if(!u)throw new Error("article not found");return{type:u.type,document:{title:u.title}}},mutate:r},null),e(q,{class:"mt-6",justify:"end"},{default:()=>[e(z,{page:t.value?.pagination.currentPage,pageCount:t.value?.pagination.totalPage,onUpdatePage:n=>{a.value=n,r()}},null)]})])}}),te=c({props:{refId:{type:String,required:!0}},setup(a){const t=a.refId,{data:r,mutate:n}=I(`/api/ai/summary/${t}`,async()=>await f.api.ai.summaries.ref(t).get()),u=k(),{setHeaderButtons:l}=_();return l(e(V,{icon:e(L,null,null),name:"生成摘要",onClick:()=>{const i=u.create({title:"生成摘要",content(){return e(c({setup(){const o=h(!1);return()=>e("form",{onSubmit:m=>{m.preventDefault();const y=m.target.querySelector("input[name=lang]")?.value;y&&(o.value=!0,f.api.ai.summaries.generate.post({data:{refId:t,lang:y}}).then(v=>{v&&r.value?.summaries.push(v),i.destroy()}).finally(()=>{o.value=!1}))}},[e(E,{type:"text",inputProps:{name:"lang"},defaultValue:"zh",placeholder:"目标语言"},null),e("div",{class:"mt-4 text-right"},[e(p,{attrType:"submit",loading:o.value,round:!0,type:"primary"},{default:()=>[s("生成")]})])])}}),null,null)}})}},null)),H(()=>{l(null)}),()=>!r.value||r.value.summaries.length===0?e(w,null,null):e(F,{summaries:r.value?.summaries||[],getArticle:()=>r.value.article,mutate:n},null)}}),F=c({props:{summaries:{type:Array,required:!0},getArticle:{type:Function,required:!0},mutate:{type:Function,required:!0}},setup(a){return()=>{let t;return e(J,{bordered:!0,showDivider:!0},Z(t=a.summaries.map(r=>e(Q,{class:"ml-2",key:r.id},{suffix(){return e(O,null,{default:()=>[e(p,{onClick:()=>{const n=dialog.create({title:"修改摘要",content(){return e("form",{onSubmit:u=>{u.preventDefault();const i=u.target.querySelector("textarea")?.value;i&&f.api.ai.summaries(r.id).patch({data:{summary:i}}).then(()=>{a.mutate(),n.destroy()})}},[e(Y,{vertical:!0},{default:()=>[e(E,{inputProps:{name:"summary"},rows:6,type:"textarea",defaultValue:r.summary},null),e("div",{class:"text-right"},[e(p,{type:"primary",attrType:"submit",round:!0},{default:()=>[s("保存")]})])]})])}})},round:!0},{default:()=>[s("修改")]}),e(p,{onClick:()=>{const n=dialog.create({title:"确定？",content:"确定要删除吗？",type:"error",positiveText:"删除",negativeText:"取消",onPositiveClick(){f.api.ai.summaries(r.id).delete().then(()=>{a.mutate(),n.destroy()})}})},round:!0,type:"error"},{default:()=>[e(M,null,{default:()=>[e(K,{class:"text-white"},null)]})]})]})},default(){const n=a.getArticle(r.refId);return e(g,null,[e(G,{to:`/${n.type}/edit?id=${r.refId}`},{default:()=>[e("h2",{"data-article-id":r.refId},[n.document.title])]}),e("small",null,[s("目标语言："),r.lang,s(" /")," ",U(new Date(r.created),"yyyy-MM-dd HH:mm")]),e("p",{class:"mt-2"},[r.summary])])}})))?t:{default:()=>[t]})}}});export{se as default};
