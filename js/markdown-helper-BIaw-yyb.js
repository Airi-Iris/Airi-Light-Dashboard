import{co as B,d as S,b,c as N,r as P,w as T,e,g as r,a1 as E,p as C,T as A,Q as z,i as D,dg as j,L as V,B as y,bZ as w,dh as Y,F as H,an as R,R as L,di as U}from"./index-DYGX83NG.js";import{a as O}from"./Upload-B4DLtrIo.js";class ${constructor(l){this.strList=l,this.strList=l}parse(l){const s=l,f=/-{3,}\r?\n(.*?)-{3,}\r?\n*(.*)$/gms.exec(s);if(!f)return{text:s};const d=f.pop(),v=B(f[1]),o={},{categories:u,tags:h,date:t,updated:c,created:a,title:n}=v;return(t||a)&&(o.date=new Date(t||a).toISOString()),c&&(o.updated=new Date(c).toISOString()),o.categories=u,o.tags=h,o.title=n,Object.keys(o).forEach(i=>{typeof o[i]>"u"&&delete o[i]}),{meta:o,text:d}}start(){const l=this.strList,s=[];for(const[f,d]of l.entries())try{s.push(this.parse(d))}catch(v){throw{idx:f,err:v}}return s}}var g=function(m){return m.Post="post",m.Note="note",m}(g||{});const I=[{value:g.Post,label:"博文"},{label:"日记",value:g.Note}],G=S(()=>{const m=b(g.Post),l=b([]),s=b([]);function f(t){return new $(t).start().map((a,n)=>{const p=l.value[n].file.name.replace(/\.md$/,"");return a.meta?a.meta.slug=a.meta.slug??p:a.meta={title:p,slug:p},a.meta?.date||(a.meta.date=new Date().toISOString()),a})}const d=N();async function v(t){if(t?.preventDefault(),t?.stopPropagation(),!l.value.length)throw new ReferenceError("fileList is empty");const c=[];for await(const a of l.value){const n=await Promise.resolve(new Promise((i,p)=>{const x=a.file;if(!x){d.error("文件不存在"),p("File is empty");return}const k=x.name.split(".").pop();if(x.type&&x.type!=="text/markdown"||!["md","markdown"].includes(k)){d.error(`只能解析 markdown 文件，但是得到了 ${x.type}`),p(`File must be markdown. got type: ${x.type}, got ext: ${k}`);return}const F=new FileReader;F.addEventListener("load",M=>{i(M.target?.result||"")}),F.readAsText(x)}));console.log(n),c.push(n)}try{const a=f(c);d.success("解析完成，结果查看 console 哦"),s.value=a.map((n,i)=>({...n,filename:l.value[i].file?.name??""})),console.log(R(s))}catch(a){console.error(a.err),d.error(`文件${l.value[a.idx].name??""}解析失败，具体信息查看 console`)}}async function o(t){if(t.stopPropagation(),t.preventDefault(),!s.value.length)return d.error("请先解析!!");await L.api.markdown.import.post({data:{type:m.value,data:s.value}}),d.success("上传成功！"),l.value=[]}const u=P({includeYAMLHeader:!0,titleBigTitle:!1,filenameSlug:!1,withMetaJson:!0});async function h(){const{includeYAMLHeader:t,filenameSlug:c,withMetaJson:a,titleBigTitle:n}=u,i=await L.api.markdown.export.get({params:{slug:c,yaml:t,show_title:n,with_meta_json:a},responseType:"blob"});U(i,"markdown.zip")}return T(()=>l.value,t=>{t.length==0?s.value=[]:v()}),()=>e(H,null,[e("div",{class:"flex center md:flex-row place-content-stretch box-border w-full gap-6 h-[calc(100vh-240px)] flex-col"},[e("div",{class:"flex flex-col gap-6",style:{placeContent:"stretch flex-start"}},[e("div",{class:"relative flex md:w-[420px] min-h-[275px] w-[360px] flex-col rounded-md bg-white px-4 py-5 duration-200 card-shadow dark:bg-neutral-950 dark:hover:ring-1 dark:hover:ring-zinc-300"},[e("div",{class:"flex grow flex-col"},[e("div",{class:"line-clamp-2 text-xl font-semibold text-neutral-900 dark:text-neutral-100"},[r("从 Markdown 导入数据")]),e(E,{depth:2,class:"!text-sm mt-2 text-neutral-500 scrollbar-none dark:text-neutral-400 inline-flex items-center space-x-1"},{default:()=>[e("i",{class:"icon-[mingcute--alert-line] size-4"},null),e("span",null,[r("只能上传 markdown 文件")])]}),e("div",{class:"mt-4 text-sm text-neutral-500 dark:text-neutral-400 flex justify-start p-4"},[e(C,{labelPlacement:"left",class:"w-full flex center flex-col"},{default:()=>[e(A,{label:"导入到:",class:"w-full"},{default:()=>[e(z,{options:I,value:m.value,onUpdateValue:t=>void(m.value=t),themeOverrides:{peers:{InternalSelection:{borderRadius:"0.5rem"}}}},null)]}),e("span",{class:"mb-2"},[r("准备好了吗.")]),e(A,{class:"flex"},{default:()=>[e(D,{vertical:!0},{default:()=>[e(O,{multiple:!0,accept:".md,.markdown",onChange:j(t=>{l.value=t.fileList},250),onRemove:t=>{const a=t.file.name,n=s.value.findIndex(i=>i.filename===a);n!=-1&&s.value.splice(n,1)},fileListClass:"rounded-lg"},{default:()=>[e(V,{class:"flex"},{default:()=>[e(y,{round:!0,class:"flex-1 md:w-[120px] w-[100px]"},{default:()=>[r("先上传")]}),e(y,{onClick:v,class:"flex-1 md:w-[120px] w-[100px]",disabled:!l.value.length},{default:()=>[r("再解析")]}),e(y,{onClick:o,class:"flex-1 md:w-[120px] w-[100px]",round:!0,disabled:!s.value.length},{default:()=>[r("最后导入")]})]})]})]})]}),e(E,{depth:2,class:"!text-sm mt-2 text-neutral-500 scrollbar-none dark:text-neutral-400 inline-flex items-center space-x-1"},{default:()=>[e("i",{class:"icon-[mingcute--alert-line] size-4"},null),e("span",null,[r("只能上传 markdown 文件")])]})]})])])])]),e("div",{class:"flex flex-col gap-6",style:{placeContent:"stretch flex-start"}},[e("div",{class:"relative flex md:w-[420px] md:h-[275px] min-h-[275px] w-[360px] flex-col rounded-md bg-white px-4 py-5 duration-200 card-shadow dark:bg-neutral-950 dark:hover:ring-1 dark:hover:ring-zinc-300"},[e("div",{class:"flex grow flex-col"},[e("div",{class:"line-clamp-2 text-xl font-semibold text-neutral-900 dark:text-neutral-100"},[r("导出数据到 Markdown (Hexo YAML Format)")]),e("div",{class:"mt-4 text-sm dark:text-neutral-400 flex justify-start p-4"},[e(C,{labelPlacement:"left",class:"w-full flex justify-center flex-col"},{default:()=>[e("div",{class:"flex items-center justify-between space-x-2 text-[1em] mb-3 mt-1"},[e("label",{class:"text-[1.1em] font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"},[r("是否包括 Yaml Header")]),e(w,{size:"small",value:u.includeYAMLHeader,onUpdateValue:t=>void(u.includeYAMLHeader=t)},null)]),e("div",{class:"flex items-center justify-between space-x-2 text-[1em] my-3"},[e("label",{class:"text-[1.1em] font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"},[r("是否在第一行显示文章标题")]),e(w,{size:"small",value:u.titleBigTitle,onUpdateValue:t=>void(u.titleBigTitle=t)},null)]),e("div",{class:"flex items-center justify-between space-x-2 text-[1em] my-3"},[e("label",{class:"text-[1.1em] font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"},[r("根据 slug 生成文件名")]),e(w,{size:"small",value:u.filenameSlug,onUpdateValue:t=>void(u.filenameSlug=t)},null)]),e("div",{class:"flex items-center justify-between space-x-2 text-[1em] my-3"},[e("label",{class:"text-[1.1em] font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"},[r("导出元数据 JSON")]),e(w,{size:"small",value:u.withMetaJson,onUpdateValue:t=>void(u.withMetaJson=t)},null)]),e("div",{class:"w-full text-right mt-3"},[e(Y,{variant:"secondary",onClick:h},{default:()=>[e("div",{class:"inline-flex space-x-2 center"},[e("i",{class:"icon-[mingcute--archive-line] size-4"},null),e("span",null,[r("导出")])])]})])]})])])])])])])});export{G as default};
