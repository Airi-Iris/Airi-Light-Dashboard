import{d as p,X as f,o as h,e,n as x,F as o,g as r,aq as y,bs as g,i as b,j as v,B as F,R as l,dx as T}from"./index-DrqTzKeg.js";const k=p({setup(){const{data:u,fetchDataFn:i,loading:c}=f(t=>async()=>{const s=await l.api.health.cron.get();t.value=Array.from(Object.values(s.data).map(a=>({...a,_name:a.name,name:T(a.name)})))});h(async()=>{await i()});const d=async(t,s)=>{await l.api.health.cron.run(t).post();let a=setTimeout(function m(){l.api.health.cron.task(t).get().then(n=>{n.status==="fulfill"?(message.success(`${s} 执行完成`),a=clearTimeout(a)):n.status==="reject"?(message.error(`${s} 执行失败，${n.message}`),a=clearTimeout(a)):a=setTimeout(m,1e3)})},1e3)};return()=>e("div",{class:"relative -mt-12 flex w-full grow flex-col"},[e("div",{class:"mt-[5rem] p-12 pt-[6px]"},[e(x,{class:"rounded-md border border-solid border-border","content-style":"padding: 0;"},{header(){return e(o,null,[e("div",{class:"flex flex-col mb-4 select-none"},[e("h1",{class:"flex items-center text-[1.73rem]"},[r("任务")]),e("h2",{class:"opacity-80 text-sm inline-flex"},[r("维护 · 任务")])])])},default(){return e(o,null,[e(y,{noPagination:!0,data:u,loading:c.value,nTableProps:{maxHeight:"calc(100vh - 17rem)"},maxWidth:500,columns:[{title:"任务",key:"name",ellipsis:{tooltip:!0},width:150},{title:"描述",key:"description",width:250,ellipsis:{tooltip:!0}},{title:"状态",key:"status"},{title:"下次执行",key:"",render(t){const s=t.nextDate;return s?g(new Date(s),"MM/dd/yyyy hh:mm:ss"):"N/A"}},{title:"操作",key:"",render(t){return e(b,null,{default:()=>[e(v,{onPositiveClick:()=>void d(t._name,t.name)},{trigger(){return e(F,{size:"tiny",quaternary:!0,type:"primary"},{default:()=>[r("执行")]})},default:()=>e("span",{class:"max-w-48"},[r("确定要执行？")])})]})}}]},null)])}})])])}});export{k as default};
