import{bM as Oe,bN as Ie,bO as Ke,bP as Pe,d as g,b as x,o as Fe,c as Te,a2 as N,u as S,Y as k,e,p as E,bQ as v,bR as c,g as l,bS as te,B as D,T as y,F as h,a0 as q,bC as Y,a1 as O,s as B,i as w,R as A,bT as ye,S as Ve,bU as $,aH as ve,r as P,w as I,bV as Ue,bW as qe,aL as Ee,bX as K,bY as be,x as Be,af as ge,bZ as _,b2 as xe,b_ as Ae,Q as Ce,f as he,ax as De,an as ze,b$ as Le,O as le,m as ae,j as R,a7 as z,k as Me,bH as G,D as we,aZ as ne,v as Re,n as Je,bG as $e,h as Se,a_ as _e,bp as se,c0 as re,c1 as ke,al as He,W as We,ao as Ge,ap as X}from"./index-DrqTzKeg.js";import{K as ie}from"./index-NBEhA2ez.js";import{U as Q}from"./index-Y2Oz8VDu.js";import{i as T}from"./isEmpty-CRld5mpT.js";import{N as Xe,a as oe}from"./Grid-CqLZMRUq.js";import{c as je}from"./cloneDeep-DwHimFPf.js";import{N as de}from"./Upload-BL3i3YtU.js";import{u as Qe}from"./index-BI8M-zx3.js";import{N as Z}from"./LayoutContent-rp3tOS9M.js";import{N as Ye,a as Ze}from"./ListItem-B495cGJh.js";import"./_baseClone-F2EjVhq3.js";function eu(u){return Oe(Ie(u).toLowerCase())}var ce=Ke(function(u,s,i){return s=s.toLowerCase(),u+(i?eu(s):s)});function J(u,s,i){return u==null?u:Pe(u,s,i)}const fe=g({props:{condition:{type:[Boolean,Function],required:!0}},setup(u,{slots:s}){const i=()=>{if(typeof u.condition=="function"?u.condition():u.condition)return s.default?.()};return()=>i()}}),L={GitHub:"github",Weibo:"weibo",网易云:"netease",哔哩哔哩:"bilibili"},uu="_avatar_o6f2e_3",tu="_settings_o6f2e_9",V={"tab-user":"_tab-user_o6f2e_1",avatar:uu,settings:tu},lu=g(()=>{const u=x({});let s;async function i(){const t=await A.api.master.get();u.value=t,s={...t}}Fe(async()=>{await i()});const F=Te(),o=N(()=>ye(s,u.value)),f=async()=>{const t=je(Ve(o));t.socialIds&&(t.socialIds=u.value.socialIds),await A.api.master.patch({data:t}),F.success("保存成功~"),await i(),location.reload()},m="https://kanodayo.com/assets/avatar.png",a=S(k).viewport.value.mobile;return()=>a?e(h,null,[e(Xe,{cols:"1 400:1 600:2",class:V["tab-user"],xGap:20,yGap:20},{default:()=>[e(oe,null,{default:()=>[e(E,{class:"flex flex-col items-center justify-center "},{default:()=>[e(y,null,{default:()=>[e("div",{class:V.avatar},[e(Q,{type:"avatar",onFinish:t=>{const{file:n,event:r}=t;try{const p=JSON.parse((r?.target).responseText);u.value.avatar=p.url}catch{}return n}},{default:()=>[e(de,{class:"border-0 bg-transparent hover:border-0"},{default:()=>[e(te,{class:"flex",src:u.value.avatar,size:200},null)]})]})])]}),e(y,{label:"上次登录时间",class:"!mt-4"},{default:()=>[e("div",{class:"w-full text-center"},[e(O,null,{default:()=>[u.value.lastLoginTime?e(q,{time:u.value.lastLoginTime},null):"N/A"]})])]}),e(y,{label:"上次登录地址"},{default:()=>[e("div",{class:"w-full text-center"},[u.value.lastLoginIp?e(Y,{trigger:"hover",ip:u.value.lastLoginIp,triggerEl:e(O,{class:"cursor-pointer"},{default:()=>[u.value.lastLoginIp]})},null):"N/A"])]}),e(y,null,{default:()=>[e(D,{round:!0,class:"-mt-14",type:"primary",onClick:f,disabled:T(o.value)},{default:()=>[l("保存")]})]})]})]}),e(oe,null,{default:()=>[e(E,null,{default:()=>[e(y,{label:"主人名 (username)"},{default:()=>[e(B,{value:u.value.username,onInput:t=>{u.value.username=t?.trim()||""}},null)]}),e(y,{label:"主人昵称 (name)"},{default:()=>[e(B,{value:u.value.name,onInput:t=>{u.value.name=t?.trim()||""}},null)]}),e(y,{label:"主人邮箱 (mail)"},{default:()=>[e(B,{value:u.value.mail,onInput:t=>{u.value.mail=t}},null)]}),e(y,{label:"个人首页"},{default:()=>[e(B,{value:u.value.url,onInput:t=>{u.value.url=t}},null)]}),e(y,{label:"头像"},{default:()=>[e(B,{value:u.value.avatar,onInput:t=>{u.value.avatar=t}},null)]}),e(y,{label:"个人介绍"},{default:()=>[e(B,{type:"textarea",resizable:!1,value:u.value.introduce,onInput:t=>{u.value.introduce=t}},null)]}),e(y,{label:"社交平台 ID 录入"},{default:()=>[e(ie,{key:u.value.id,options:Object.keys(L).map(t=>({label:t,value:L[t]})),onChange:t=>{u.value.socialIds=t},value:u.value.socialIds||{}},null)]})]})]})]})]):e(h,null,[e("div",{class:["flex flex-col w-full justify-center",V.settings]},[e(E,null,{default:()=>[e(v,{class:"justify-center !my-4"},{default:()=>[e(c,{span:"6"},{default:()=>[e("h4",{class:"text-2xl font-semibold"},[l("个人头像")]),e("p",null,[l("您可以在这里修改头像或删除当前头像，"),e("br",null,null),l("并恢复为默认值。")])]}),e(c,{span:"6"},{default:()=>[e(v,null,{default:()=>[e(c,{span:"6",class:"flex center"},{default:()=>[e(Q,{class:"w-[150px] h-[104px]",type:"avatar",onFinish:t=>{const{file:n,event:r}=t;try{const p=JSON.parse((r?.target).responseText);u.value.avatar=p.url}catch{}return n}},{default:()=>[e(de,{class:"border-0 hover:border-0 p-0 items-center justify-start flex bg-transparent"},{default:()=>[e(te,{class:"flex border border-solid border-[#f0f0f0]",src:u.value.avatar||m,size:96},null)]})]})]}),e(c,{span:"18"},{default:()=>[e("h5",{class:"mt-0 mb-10px font-semibold leading-normal text-lg"},[l("上传新头像")]),e("div",{class:"flex items-center my-3"},[e(Q,{type:"avatar",onFinish:t=>{const{file:n,event:r}=t;try{const p=JSON.parse((r?.target).responseText);u.value.avatar=p.url}catch{}return n}},{default:()=>[e(D,{type:"default",ghost:!0,class:"border border-solid border-[#dedee3] dark:border-gray-400/50 hover:!border-[#0960bd] hover:!text-[#0960bd] transition duration-300",size:"small",themeOverrides:{border:"none",borderHover:"none",textColorGhostHover:"none"}},{default:()=>[l("选择文件...")]})]})]),e("div",{class:"text-gray-500 my-3"},[l("建议文件大小"),"<",l("1MB。太大容易导致加载缓慢")]),e(D,{ghost:!0,type:"error",size:"small",disabled:!0,onClick:()=>{u.value.avatar=m}},{default:()=>[l("恢复默认头像")]})]})]})]})]}),e(b,null,null),e(v,{class:"justify-center !my-4"},{default:()=>[e(c,{span:"6"},{default:()=>[e("h4",{class:"text-2xl font-semibold"},[l("登录信息")]),e("p",null,[l("账号当前的登录信息")])]}),e(c,{span:"6"},{default:()=>[e("div",{class:"flex justify-start flex-row mb-2"},[e(y,{label:"上次登录时间",size:"small","show-feedback":!1,class:"flex flex-col items-start justify-center","label-style":{padding:"0"}},{default:()=>[e(h,null,[u.value.lastLoginTime?e(q,{time:u.value.lastLoginTime},null):"N/A"])]}),e(y,{label:"上次登录地址",size:"small",class:"flex flex-col items-start justify-center ml-72","show-feedback":!1,"label-style":{padding:"0"}},{default:()=>[e(h,null,[u.value.lastLoginIp?e(Y,{trigger:"hover",ip:u.value.lastLoginIp,triggerEl:e(O,{class:"cursor-pointer"},{default:()=>[u.value.lastLoginIp]})},null):"N/A"])]})]),e("div",{class:"inline-flex space-x-4"},[e("small",{class:""},[l("我从哪来的，我什么时候来的？")]),e("small",{class:"text-gray-500/40 select-none"},[u.value.id])])]})]}),e(b,null,null),e(v,{class:"justify-center !my-4"},{default:()=>[e(c,{span:"6"},{default:()=>[e("h4",{class:"text-2xl font-semibold"},[l("主要信息")]),e("p",null,[l("此信息的部分条目将出现在您的个人资料中。")])]}),e(c,{span:"6"},{default:()=>[e(v,{class:"justify-between"},{default:()=>[e(c,{span:"8"},{default:()=>[e(y,{label:"主人名 (username)"},{default:()=>[e(B,{class:"rounded-lg",placeholder:"这是登录系统的名字哦~",value:u.value.username,onInput:t=>{u.value.username=t?.trim()||""}},null)]})]}),e(c,{span:"14"},{default:()=>[e(y,{label:"主人邮箱 (mail)"},{default:()=>[e(B,{class:"rounded-lg",placeholder:"主人的邮箱用于接收系统以及订阅通知~",value:u.value.mail,onInput:t=>{u.value.mail=t}},null)]})]})]}),e(y,{label:"主人昵称 (name)"},{default:()=>[e(B,{class:"rounded-lg",placeholder:"这是显示在评论以及文章作者等地方的名字哦~",value:u.value.name,onInput:t=>{u.value.name=t?.trim()||""}},null)]})]})]}),e(b,null,null),e(v,{class:"justify-center !my-4"},{default:()=>[e(c,{span:"6"},{default:()=>[e("h4",{class:"text-2xl font-semibold"},[l("额外信息")]),e("p",null,[l("补充的个人信息。如个人首页，介绍，社交平台等")])]}),e(c,{span:"6"},{default:()=>[e(y,{label:"个人首页"},{default:()=>[e(B,{class:"rounded-lg",value:u.value.url,placeholder:"主人的个人首页~",onInput:t=>{u.value.url=t}},null)]}),e(y,{label:"头像（使用CDN头像）"},{default:()=>[e(B,{class:"rounded-lg",value:u.value.avatar,onInput:t=>{u.value.avatar=t}},null)]}),e(y,{label:"个人介绍"},{default:()=>[e(B,{class:"rounded-lg",placeholder:"描述一下自己吧~",type:"textarea",resizable:!1,value:u.value.introduce,onInput:t=>{u.value.introduce=t}},null)]}),e(y,{label:"社交平台 ID 录入"},{default:()=>[e(ie,{key:u.value.id,options:Object.keys(L).map(t=>({label:t,value:L[t]})),onChange:t=>{u.value.socialIds=t},value:u.value.socialIds||{}},null)]})]})]}),e(b,null,null),e(v,{class:"justify-center !my-2"},{default:()=>[e(c,{span:"6"},{default:()=>[e(w,{class:"justify-center !my-2"},{default:()=>[e(D,{type:"primary",color:"#0960bd",class:"dark:text-[#f0f8ff] !h-[31px] rounded-md",onClick:f,disabled:T(o.value),themeOverrides:{textColorHoverPrimary:"#f0f8ff"}},{default:()=>[l("更新个人资料")]}),e(D,{secondary:!0,class:"!h-[31px] rounded-md",disabled:T(o.value),onClick:()=>{location.reload()}},{default:()=>[l("取消")]})]})]}),e(c,{span:"6"},null)]})]})])])}),b=g({setup(){return()=>e(v,{class:"justify-center !my-4"},{default:()=>[e(c,{span:"12"},{default:()=>[e("hr",null,null)]})]})}});function U(u){return typeof u=="function"||Object.prototype.toString.call(u)==="[object Object]"&&!Be(u)}const au="mt-6",nu={class:au,labelPlacement:"left",labelAlign:"right",labelWidth:150,autocomplete:"do-not-autofill"},su={labelPlacement:"left",labelAlign:"right",labelWidth:150,autocomplete:"do-not-autofill"},H=Symbol("JSONSchemaFormInject"),ru=g({props:{schema:{type:Object,required:!0},onValueChange:{type:Function,required:!1},initialValue:{type:Object,required:!0},getKey:{type:Function,required:!1,default:u=>u},extendConfigView:{type:Object}},setup(u,{slots:s}){const i=x(u.initialValue);$(()=>{u.onValueChange?.(i.value)},{flush:"post"});const F=N(()=>u.schema.definitions),o=N(()=>new Map(Object.entries(u.schema.definitions)));ve(H,{schema:u.schema,definitions:o,getKey:u.getKey});const f=N(()=>Object.keys(F.value)),m=S(k),d=P(su);I(()=>m.viewport.value.mobile,t=>{t?(d.labelPlacement="top",d.labelAlign="left"):(d.labelPlacement="left",d.labelAlign="right")},{immediate:!0});const a=(t,n,r,p)=>{switch(t){case"UrlDto":return e(v,{class:"justify-center !my-4","data-schema":JSON.stringify(n)},{default:()=>[e(c,{span:"6"},{default:()=>[e("h4",{class:"text-2xl font-semibold"},[n.title]),e("p",null,[l("您可以在这里修改网站相关的设定如 博客地址,"),e("br",null,null),l("管理后台地址, API地址以及Gateway地址")])]}),e(c,{span:"6"},{default:()=>[e(E,d,{default:()=>[e(C,{dataKey:p.getKey(t),formData:r,schema:n,property:t},null)]})]}),e(b,null,null)]});case"SeoDto":return e(v,{class:"justify-center !my-4","data-schema":JSON.stringify(n)},{default:()=>[e(c,{span:"6"},{default:()=>[e("h4",{class:"text-2xl font-semibold"},[n.title]),e("p",null,[l("您可以在这里修改SEO中的相关设定, 如"),e("br",null,null),l("网站标题,网站描述以及关键词等相关的设定")])]}),e(c,{span:"6"},{default:()=>[e(E,d,{default:()=>[e(C,{dataKey:p.getKey(t),formData:r,schema:n,property:t},null)]})]}),e(b,null,null)]});case"AdminExtraDto":return e(v,{class:"justify-center !my-4","data-schema":JSON.stringify(n)},{default:()=>[e(c,{span:"6"},{default:()=>[e("h4",{class:"text-2xl font-semibold"},[n.title]),e("p",null,[l("您可以在这里修改后台附加项目的相关的设定,"),e("br",null,null),l("如后台反代, 后台管理的副标题以及登录页背景,"),e("br",null,null),l("以及高德地图的查询 API Key")])]}),e(c,{span:"6"},{default:()=>[e(E,d,{default:()=>[e(C,{dataKey:p.getKey(t),formData:r,schema:n,property:t},null)]})]}),e(b,null,null)]});case"TextOptionsDto":return e(v,{class:"justify-center !my-4","data-schema":JSON.stringify(n)},{default:()=>[e(c,{span:"6"},{default:()=>[e("h4",{class:"text-2xl font-semibold"},[n.title]),e("p",null,[l("您可以在这里设置 "),e("strong",null,[l("文本宏替换")]),l(" 功能是否开启")])]}),e(c,{span:"6"},{default:()=>[e(E,d,{default:()=>[e(C,{dataKey:p.getKey(t),formData:r,schema:n,property:t},null)]})]}),e(b,null,null)]});case"MailOptionsDto":return e(v,{class:"justify-center !my-4","data-schema":JSON.stringify(n)},{default:()=>[e(c,{span:"6"},{default:()=>[e("h4",{class:"text-2xl font-semibold"},[n.title]),e("p",null,[l("您可以在这里修改邮件通知相关的设定,如是否开启邮件通知,"),e("br",null,null),l("发件邮箱的地址,端口,密码,Host以及"),e("br",null,null),l("是否使用SSL/TLS")])]}),e(c,{span:"6"},{default:()=>[e(E,d,{default:()=>[e(C,{dataKey:p.getKey(t),formData:r,schema:n,property:t},null)]})]}),e(b,null,null)]});case"CommentOptionsDto":return e(v,{class:"justify-center !my-4","data-schema":JSON.stringify(n)},{default:()=>[e(c,{span:"6"},{default:()=>[e("h4",{class:"text-2xl font-semibold"},[n.title]),e("p",null,[l("您可以在这里修改评论相关的设定,如是否开启反垃圾评论,"),e("br",null,null),l("是否禁止全站评论以及添加自定义屏蔽关键词等")])]}),e(c,{span:"6"},{default:()=>[e(E,d,{default:()=>[e(C,{dataKey:p.getKey(t),formData:r,schema:n,property:t},null)]})]}),e(b,null,null)]});case"BarkOptionsDto":return e(v,{class:"justify-center !my-4","data-schema":JSON.stringify(n)},{default:()=>[e(c,{span:"6"},{default:()=>[e("h4",{class:"text-2xl font-semibold"},[n.title]),e("p",null,[l("您可以在这里修改 Bark通知相关的设定,如是否开启Bark通知"),e("br",null,null),l("修改设备Key, 服务器URL等")])]}),e(c,{span:"6"},{default:()=>[e(E,d,{default:()=>[e(C,{dataKey:p.getKey(t),formData:r,schema:n,property:t},null)]})]}),e(b,null,null)]});case"FriendLinkOptionsDto":return e(v,{class:"justify-center !my-4","data-schema":JSON.stringify(n)},{default:()=>[e(c,{span:"6"},{default:()=>[e("h4",{class:"text-2xl font-semibold"},[n.title]),e("p",null,[l("您可以在这里修改友链相关的设定，如是否允许申请友链")])]}),e(c,{span:"6"},{default:()=>[e(E,d,{default:()=>[e(C,{dataKey:p.getKey(t),formData:r,schema:n,property:t},null)]})]}),e(b,null,null)]});case"BackupOptionsDto":return e(v,{class:"justify-center !my-4","data-schema":JSON.stringify(n)},{default:()=>[e(c,{span:"6"},{default:()=>[e("h4",{class:"text-2xl font-semibold"},[n.title]),e("p",null,[l("您可以在这里修改备份相关的设定,如是否开启自动备份"),e("br",null,null),l("Amazon S3服务端点,SecretID,SecretKey,Bucket"),e("br",null,null),l("以及地域 Region等设置")])]}),e(c,{span:"6"},{default:()=>[e(E,d,{default:()=>[e(C,{dataKey:p.getKey(t),formData:r,schema:n,property:t},null)]})]}),e(b,null,null)]});case"BaiduSearchOptionsDto":return e(v,{class:"justify-center !my-4","data-schema":JSON.stringify(n)},{default:()=>[e(c,{span:"6"},{default:()=>[e("h4",{class:"text-2xl font-semibold"},[n.title]),e("p",null,[l("您可以在这里修改百度推送相关的设定,如Token,"),e("br",null,null),l("是否开启推送等")])]}),e(c,{span:"6"},{default:()=>[e(E,d,{default:()=>[e(C,{dataKey:p.getKey(t),formData:r,schema:n,property:t},null)]})]}),e(b,null,null)]});case"AlgoliaSearchOptionsDto":return e(v,{class:"justify-center !my-4","data-schema":JSON.stringify(n)},{default:()=>[e(c,{span:"6"},{default:()=>[e("h4",{class:"text-2xl font-semibold"},[n.title]),e("p",null,[l("您可以在这里修改Algolia Search相关的设定, 如API Key,"),e("br",null,null),l("APP ID, IndexName以及是否开启搜索功能等")])]}),e(c,{span:"6"},{default:()=>[e(E,d,{default:()=>[e(C,{dataKey:p.getKey(t),formData:r,schema:n,property:t},null)]})]}),e(b,null,null)]});case"ClerkOptionsDto":return e(v,{class:"justify-center !my-4","data-schema":JSON.stringify(n)},{default:()=>[e(c,{span:"6"},{default:()=>[e("h4",{class:"text-2xl font-semibold"},[n.title]),e("p",null,[l("您可以在这里修改Clerk鉴权绑定相关的设定,如Clerk User ID,"),e("br",null,null),l("JWT PEM Key, Secret Key以及是否开启鉴权等设置")])]}),e(c,{span:"6"},{default:()=>[e(E,d,{default:()=>[e(C,{dataKey:p.getKey(t),formData:r,schema:n,property:t},null)]})]}),e(b,null,null)]});case"FeatureListDto":return e(v,{class:"justify-center !my-4","data-schema":JSON.stringify(n)},{default:()=>[e(c,{span:"6"},{default:()=>[e("h4",{class:"text-2xl font-semibold"},[n.title]),e("p",null,[l("您可以在这里修改如邮件推送订阅等相关功能等设定")])]}),e(c,{span:"6"},{default:()=>[e(E,d,{default:()=>[e(C,{dataKey:p.getKey(t),formData:r,schema:n,property:t},null)]})]}),e(b,null,null)]});case"ThirdPartyServiceIntegrationDto":return e(v,{class:"justify-center !my-4","data-schema":JSON.stringify(n)},{default:()=>[e(c,{span:"6"},{default:()=>[e("h4",{class:"text-2xl font-semibold"},[n.title]),e("p",null,[l("您可以在这里修改第三方服务的相关的设定"),e("br",null,null),l("如xLog（开源创作社区）的xLog SiteId")])]}),e(c,{span:"6"},{default:()=>[e(E,d,{default:()=>[e(C,{dataKey:p.getKey(t),formData:r,schema:n,property:t},null)]})]}),e(b,null,null)]});case"AIDto":return e(v,{class:"justify-center !my-4","data-schema":JSON.stringify(n)},{default:()=>[e(c,{span:"6"},{default:()=>[e("h4",{class:"text-2xl font-semibold"},[n.title]),e("p",null,[l("您可以在这里修改AI 相关的设定, 如OpenAI key, Endpoint"),e("br",null,null),l("以及是否可以调用AI生成摘要, 以及是否自动生成摘要")])]}),e(c,{span:"6"},{default:()=>[e(E,d,{default:()=>[e(C,{dataKey:p.getKey(t),formData:r,schema:n,property:t},null)]})]})]});default:return null}};return()=>{let t;const{schema:n}=u;return e(h,null,[e("div",{class:"h-fit flex flex-col"},[f.value.map(r=>{const p=F.value[r];if(!p.title)return null;switch((p?.["ui:options"]||{})?.type){case"hidden":return null}return a(r,p,i,u)})]),s.default?.(),n.ps.length?e(w,{vertical:!0},U(t=n.ps.map(r=>e(O,{class:"ml-4 mt-8 mb-4 inline-block text-xs",depth:3},U(r)?r:{default:()=>[r]})))?t:{default:()=>[t]}):null])}}}),C=g({props:{schema:{type:Object,required:!0},formData:{type:Object,required:!0},dataKey:{type:String,required:!0},property:{type:String}},setup(u){const{definitions:s,getKey:i}=Ee(H,{});return()=>{const{schema:F,formData:o,dataKey:f,property:m}=u;return F?e(h,null,[Object.keys(F.properties).map(d=>{const a=F.properties[d];if(a.$ref){const t=s.value.get(a.$ref.split("/").at(-1));return e(C,{dataKey:`${i(f)}.${d}`,formData:o,schema:t,property:d},null)}return e(iu,{value:K(o.value,`${i(f)}.${d}`,void 0),onUpdateValue:t=>{K(o.value,i(f))?J(o.value,`${i(f)}.${d}`,t):J(o.value,i(f),{...K(o.value,i(f),{}),[d]:t})},title:a.title,type:a.type,options:a?.["ui:options"],description:a.description},null)})]):null}}}),iu=g({props:{type:{type:String,required:!0},title:{type:String,required:!0},description:{type:String},options:{type:Object,default:()=>({})},value:{type:null,required:!0},onUpdateValue:{type:Function,required:!0}},setup(u){const s=x(u.value);$(()=>{u.onUpdateValue(s.value)});const i=()=>{const{options:F}=u;switch(u.type){case"url":case"string":{const{type:o}=F;switch(o){case"select":const{values:f}=F;return e(Ce,{value:s.value,onUpdateValue:m=>{s.value=m},options:f,filterable:!0,themeOverrides:{peers:{InternalSelection:{borderRadius:"0.5rem"}}}},null);default:return e(B,{class:"rounded-lg",inputProps:{id:Ae()},value:s.value,onUpdateValue:m=>{s.value=m},type:o||"text",showPasswordOn:"click",autosize:o=="textarea"?{maxRows:5,minRows:3}:void 0,clearable:!0},null)}}case"array":return e(xe,{value:s.value,onUpdateValue:o=>{s.value=o}},{trigger(o){return e(g({setup(){return()=>e("button",{onClick:o.activate},[e("div",{class:he("border-foreground-400/80 w-fit items-center justify-center !text-[#2080f0] inline-flex space-x-1","transition-colors ease-in-out duration-300 hover:!text-[#4098fc]")},[e("i",{class:"icon-[mingcute--add-line] size-4"},null),e("span",null,[l("添加")])])])}}),null,null)}});case"boolean":return e(_,{value:s.value,onUpdateValue:o=>{s.value=o}},null);case"integer":return e(ge,{value:s.value,onUpdateValue:o=>{s.value=o}},null);default:return null}};return()=>{const{title:F,options:o,description:f}=u;return e(h,null,[e(y,{label:F},{default:()=>[f?e(w,{class:"w-full",vertical:!0},{default:()=>[i(),e(O,{class:"text-xs",depth:3},{default:()=>[e("span",{innerHTML:be.parse(f)},null)]})]}):i()]})])}}}),ou=g({props:{schema:{type:Object,required:!0},onValueChange:{type:Function,required:!1},initialValue:{type:Object,required:!0},getKey:{type:Function,required:!1,default:u=>u},extendConfigView:{type:Object}},setup(u,{slots:s}){const i=x(u.initialValue);$(()=>{u.onValueChange?.(i.value)},{flush:"post"});const F=N(()=>u.schema.definitions),o=N(()=>new Map(Object.entries(u.schema.definitions)));ve(H,{schema:u.schema,definitions:o,getKey:u.getKey});const f=N(()=>Object.keys(F.value)),m=x([f.value[0]]),d=S(k),a=P(nu);return I(()=>d.viewport.value.mobile,t=>{t?(a.labelPlacement="top",a.labelAlign="left"):(a.labelPlacement="left",a.labelAlign="right")},{immediate:!0}),()=>{let t,n;const{schema:r}=u;return e(h,null,[e(Ue,{accordion:!0,defaultExpandedNames:m.value,displayDirective:"if"},U(t=f.value.map(p=>{const j=F.value[p];if(!j.title)return null;switch((j?.["ui:options"]||{})?.type){case"hidden":return null}return e(qe,{title:j.title,"data-schema":JSON.stringify(j)},{default:()=>[e(E,a,{default:()=>[e(Ne,{dataKey:u.getKey(p),formData:i,schema:j,property:p},null),u.extendConfigView?.[p],s[p]?.()]})]})}))?t:{default:()=>[t]}),r.ps.length?e(w,{vertical:!0},U(n=r.ps.map(p=>e(O,{class:"ml-4 mt-8 inline-block text-xs",depth:3},U(p)?p:{default:()=>[p]})))?n:{default:()=>[n]}):null])}}}),Ne=g({props:{schema:{type:Object,required:!0},formData:{type:Object,required:!0},dataKey:{type:String,required:!0},property:{type:String}},setup(u){const{definitions:s,getKey:i}=Ee(H,{});return()=>{const{schema:F,formData:o,dataKey:f,property:m}=u;return F?e(h,null,[Object.keys(F.properties).map(d=>{const a=F.properties[d];if(a.$ref){const t=s.value.get(a.$ref.split("/").at(-1));return e(Ne,{dataKey:`${i(f)}.${d}`,formData:o,schema:t,property:d},null)}return e(du,{value:K(o.value,`${i(f)}.${d}`,void 0),onUpdateValue:t=>{K(o.value,i(f))?J(o.value,`${i(f)}.${d}`,t):J(o.value,i(f),{...K(o.value,i(f),{}),[d]:t})},title:a.title,type:a.type,options:a?.["ui:options"],description:a.description},null)})]):null}}}),du=g({props:{type:{type:String,required:!0},title:{type:String,required:!0},description:{type:String},options:{type:Object,default:()=>({})},value:{type:Object,required:!0},onUpdateValue:{type:Function,required:!0}},setup(u){const s=x(u.value);$(()=>{u.onUpdateValue(s.value)});const i=()=>{const{options:f}=u;switch(u.type){case"url":case"string":{const{type:m}=f;switch(m){case"select":const{values:d}=f;return e(Ce,{value:s.value,onUpdateValue:a=>{s.value=a},options:d,filterable:!0},null);default:return e(B,{inputProps:{id:Ae()},value:s.value,onUpdateValue:a=>{s.value=a},type:m||"text",showPasswordOn:"click",autosize:m=="textarea"?{maxRows:5,minRows:3}:void 0,clearable:!0},null)}}case"array":return e(xe,{value:s.value,onUpdateValue:m=>{s.value=m}},null);case"boolean":return e(_,{value:s.value,onUpdateValue:m=>{s.value=m}},null);case"integer":return e(ge,{value:s.value,onUpdateValue:m=>{s.value=m}},null);default:return null}},F=S(k),o=N(()=>F.viewport.value.mobile?1:2);return()=>{const{title:f,options:m,description:d}=u,a=e(h,null,[e(y,{label:f},{default:()=>[d?e(w,{class:"w-full",vertical:!0},{default:()=>[i(),e(O,{class:"text-xs",depth:3},{default:()=>[e("span",{innerHTML:be.parse(d)},null)]})]}):i()]})]);return m.halfGrid&&o.value===2?e("div",{class:"inline-block w-1/2"},[a]):a}}}),cu="mt-6",fu={class:cu,labelPlacement:"left",labelAlign:"right",labelWidth:150,autocomplete:"chrome-off"},pe={autosize:!0,clearable:!0,style:"min-width: 300px; max-width: 100%"},pu=g(()=>{Qe();const u=x(!1),s=x(!1),i=x();De(async()=>{i.value=await A.api.config.jsonschema.get({transform:!1}),await d().then(()=>{u.value=!0})});let F={};const o=P({}),f=x({});I(()=>o,r=>{f.value=ye(F,ze(r))},{deep:!0}),I(()=>f.value,r=>{T(r)?s.value=!1:s.value=!0});async function m(){if(T(f.value))return;const r=Object.entries(f.value);for await(const[p,j]of r){const ee=Object.fromEntries(Object.entries(j).map(([W,ue])=>Array.isArray(ue)?[W,o[p][W]]:[W,ue]));await A.api.options(p).patch({data:ee})}await d().then(()=>{u.value=!0}),message.success("修改成功")}const d=async()=>{let r=await A.api.options.get();r=Le(i.value.default,r),F=je(r),Object.assign(o,r)},a=S(k),t=P(fu);I(()=>a.viewport.value.mobile,r=>{r?(t.labelPlacement="top",t.labelAlign="left"):(t.labelPlacement="left",t.labelAlign="right")},{immediate:!0});const n=a.viewport.value.mobile;return()=>n?e(h,null,[e(le,null,{default:()=>[e(ae,{icon:e("i",{class:"icon-[mingcute--archive-line]"},null),className:"bg-accent size-[28px]",name:"保存当前设置",disabled:!s.value,onClick:m},null)]}),e("div",{class:"p-8 pt-0"},[i.value&&e(ou,{initialValue:o,getKey:r=>r.split(".").map(p=>ce(p)).join(".").replace("Dto",""),schema:i.value},null)])]):e(h,null,[e(le,null,{default:()=>[e(ae,{icon:e("i",{class:"icon-[mingcute--archive-line]"},null),className:"bg-accent size-[28px]",name:"保存当前设置",disabled:!s.value,onClick:m},null)]}),e("div",{class:["flex flex-col w-full justify-center h-full transition-all duration-200",V.settings]},[u.value&&i.value&&e(h,null,[e(ru,{initialValue:o,getKey:r=>r.split(".").map(p=>ce(p)).join(".").replace("Dto",""),schema:i.value},{default:()=>[e(b,null,null),e(v,{class:"justify-center !my-2"},{default:()=>[e(c,{span:"6"},{default:()=>[e(w,{class:"justify-center !my-2"},{default:()=>[e(D,{type:"primary",color:"#0960bd",class:"dark:text-[#f0f8ff] !h-[31px] rounded-md",disabled:!s.value,onClick:m,themeOverrides:{textColorHoverPrimary:"#f0f8ff"}},{default:()=>[l("保存当前设置")]}),e(D,{secondary:!0,class:"!h-[31px] rounded-md",disabled:!s.value,onClick:()=>{location.reload()}},{default:()=>[l("取消")]})]})]}),e(c,{span:"6"},null)]})]})])])])});function me(u){return typeof u=="function"||Object.prototype.toString.call(u)==="[object Object]"&&!Be(u)}const mu=g(()=>{const u=x([]),s=async()=>{const m=await A.api.user.session.get({});u.value=[...m.data]};Fe(()=>{s()});const i=async(m,d)=>{m?(await A.api.user.logout.post({}),ke(),window.location.reload()):(await A.api.user.session(d).delete({}),u.value=u.value.filter(a=>a.id!==d))},F=async()=>{await A.api.user.session.all.delete({}),await s()};return S(k).viewport.value.mobile?()=>e("div",{class:"flex center h-[calc(100vh-14rem)] text-center"},[e("strong",null,[l("此页面移动端暂未适配，请到桌面端查看")])]):()=>{let m;return e(h,null,[e("div",{class:["flex flex-col w-full justify-center",V.settings]},[e(Eu,null,null),e(b,null,null),e(Fu,null,null),e(yu,null,null),e(v,{class:"justify-center mb-4 pt-4"},{default:()=>[e(c,{span:"24"},{default:()=>[e("hr",null,null)]})]}),e(vu,null,null),e(v,{class:"justify-center mb-4 pt-4"},{default:()=>[e(c,{span:"24"},{default:()=>[e("hr",null,null)]})]})]),e("div",{class:"flex flex-col my-4"},[e("div",{class:"flex flex-row items-center justify-between px-16"},[e("h1",{class:"text-2xl font-bold felx flex-row"},[l("登录设备"),e("small",{class:"text-base font-normal ml-8"},[l("查看已经登录的设备")])]),e(R,{onPositiveClick:F},{trigger(){return e(z,{icon:e("i",{class:"icon-[mingcute--alert-line] size-[16px]"},null),class:"rounded-lg text-[#d03050]",variant:"secondary",description:"全部下线",disabled:u.value.length==1&&u.value[0].current},null)},default(){return"确定踢掉全部登录设备（除当前会话）？"}})]),e(Z,{class:"!overflow-visible px-16 mt-4"},{default:()=>[e(Ye,{bordered:!0,class:"item_prefix"},me(m=u.value.map(({id:d,ua:a,ip:t,date:n,current:r})=>e(Ze,{key:d},{prefix(){return r?e(Me,{type:"success",size:"small",strong:!0,class:"rounded-lg"},{default:()=>[l("当前")]}):e("div",{class:"w-[38px]"},null)},suffix(){return e(R,{onPositiveClick:()=>i(!!r,d)},{trigger(){return e(z,{icon:r?e("i",{class:"icon-[mingcute--exit-line] size-[16px]"},null):e("i",{class:"icon-[mingcute--close-line] size-[16px]"},null),class:he("rounded-lg text-[#d03050]",r?"w-[70px]":""),variant:"secondary",description:r?"注销":"踢",disabled:u.value.length==1&&u.value[0].current},null)},default(){return r?"登出？":"确定要踢出吗？"}})},default(){return e(w,{vertical:!0},{default:()=>[e(fe,{condition:!!a},{default:()=>[e(G,null,{default:()=>[l("User Agent: "),a]})]}),e(fe,{condition:!!t},{default:()=>[e(G,null,{default:()=>[l("IP:")," ",e(Y,{ip:t,triggerEl:e(D,{quaternary:!0,size:"tiny",type:"primary"},me(t)?t:{default:()=>[t]})},null)]})]}),e(G,null,{default:()=>[r?"活跃时间":"登录时间",l(":")," ",e(q,{time:n},null)]})]})}})))?m:{default:()=>[m]})]})]),e("div",{class:"pt-4"},null)])}}),Fu=g(()=>{const u=P({password:"",reenteredPassword:""}),s=x(),i=we(),F=async()=>{s.value&&s.value.validate(async f=>{f?console.log(f):(await A.api.master.patch({data:{password:u.password}}),message.success("更改成功"),ke(),i.push({name:He.Login}))})};function o(f,m){return console.log(f),m===u.password}return S(k),()=>e(h,null,[e(v,{class:"justify-center !my-2"},{default:()=>[e(c,{span:"6"},{default:()=>[e("h4",{class:"mt-0 text-2xl font-semibold"},[l("密码")]),e("p",null,[l("密码更新成功后，您将被重定向到登录页面，"),e("br",null,null),l("您可以使用新密码重新登录。")])]}),e(c,{span:"6"},{default:()=>[e("h5",{class:"mt-0 mb-10px font-semibold leading-normal text-base mb-4"},[l("更改您的密码或重设当前密码")]),e(E,{ref:s,model:u,rules:{password:[{required:!0,message:"请输入密码"}],reenteredPassword:[{required:!0,message:"请再次输入密码",trigger:["input","blur"]},{validator:o,message:"两次密码输入不一致",trigger:["blur","password-input"]}]}},{default:()=>[e(y,{label:"新密码",required:!0,path:"password"},{default:()=>[e(B,ne({class:"rounded-lg"},pe,{value:u.password,onInput:f=>void(u.password=f),type:"password"}),null)]}),e(y,{label:"重复密码",required:!0,path:"reenteredPassword"},{default:()=>[e(B,ne({class:"rounded-lg"},pe,{value:u.reenteredPassword,onInput:f=>void(u.reenteredPassword=f),type:"password"}),null)]})]}),e("div",{class:"quaternary-right w-full flex items-center justify-end"},[e(D,{onClick:F,type:"primary",color:"#0960bd",class:"dark:text-[#f0f8ff] !h-[31px] rounded-md",themeOverrides:{textColorHoverPrimary:"#f0f8ff"}},{default:()=>[l("保存")]})])]})]}),e(v,{class:"justify-center !my-4"},{default:()=>[e(c,{span:"24"},{default:()=>[e("hr",null,null)]})]})])}),yu=g(()=>{const u=x([]),s=()=>({name:"",expired:!1,expiredTime:new Date}),i=P(s()),F=async()=>{const{data:a}=await A.api.passkey.items.get();u.value=a};De(()=>{F()});const o=x(!1),f=async()=>{const a={name:i.name,expired:i.expired?i.expiredTime.toISOString():void 0},t=await A.api.auth.token.post({data:a});await navigator.clipboard.writeText(t.token),o.value=!1;const n=s();for(const p in n)i[p]=n[p];message.success(`生成成功，Token 已复制，${t.token}`),await F();const r=u.value.findIndex(p=>p.name===a.name);r!==-1&&(u.value[r].token=t.token)},m=async a=>{await A.api.auth.token.delete({params:{id:a}}),message.success("删除成功");const t=u.value.findIndex(n=>n.id===a);t!=-1&&u.value.splice(t,1)},d=S(k);return()=>e("div",{class:"flex flex-col my-4"},[e("div",{class:"flex flex-row items-center justify-between px-16"},[e("h1",{class:"text-2xl font-bold felx flex-row"},[l("ApiToken"),e("small",{class:"text-base font-normal ml-8"},[l("管理已经创建的ApiToken")])]),e(z,{icon:e("i",{class:"icon-[mingcute--hashtag-line] size-[16px]"},null),class:"rounded-lg",variant:"secondary",description:"新增",onClick:()=>{o.value=!0}},null)]),e(Z,{class:"!overflow-visible px-16 mt-2"},{default:()=>[e(Re,{transformOrigin:"center",show:o.value,onUpdateShow:a=>void(o.value=a)},{default:()=>[e(Je,{bordered:!1,title:"创建 Token",class:"w-[500px] max-w-full"},{default:()=>[e(E,null,{default:()=>[e(y,{label:"名称",required:!0},{default:()=>[e(B,{value:i.name,onInput:a=>void(i.name=a)},null)]}),e(y,{label:"是否过期"},{default:()=>[e(_,{value:i.expired,onUpdateValue:a=>void(i.expired=a)},null)]}),e(y,{label:"过期时间"},{default:()=>[e($e,{disabled:!i.expired,value:i.expiredTime,type:"datetime",onUpdateValue:a=>void(i.expiredTime=new Date(a))},null)]})]}),e(w,null,{default:()=>[e(D,{round:!0,onClick:()=>void(o.value=!1)},{default:()=>[l("取消")]}),e(D,{round:!0,type:"primary",onClick:f},{default:()=>[l("确定")]})]})]})]}),e(Se,{class:"mt-2",bordered:!0,scrollX:Math.max(800,d.contentWidth.value-d.contentInsetWidth.value),remote:!0,data:u.value,columns:[{key:"name",title:"名称"},{key:"token",title:"Token",render({token:a}){return a??"*".repeat(40)}},{title:"创建时间",key:"created",render({created:a}){return e(q,{time:a},null)}},{title:"过期时间",key:"expired",render({expired:a}){return _e(a,"yyyy 年 M 月 d 日 HH:mm:ss")}},{title:"操作",key:"id",render({id:a,name:t}){return e(w,null,{default:()=>[e(R,{positiveText:"取消",negativeText:"删除",onNegativeClick:()=>{m(a)}},{trigger:()=>e(D,{quaternary:!0,type:"error"},{default:()=>[l("删除")]}),default:()=>e("span",{class:"max-w-48"},[l('确定要删除 Token "'),t,l('"?')])})]})}}]},null)]})])}),vu=g(()=>{const u=S(k),{data:s,mutate:i}=se("passkey-table",()=>A.api.passkey.items.get()),F=a=>{A.api.passkey.items(a).delete().then(()=>{i()})},o=g(a=>{const t=x(""),n=r=>{r.preventDefault(),r.stopPropagation(),re.createPassKey(t.value).then(()=>{i(),a.dialog.destroy()})};return()=>e(E,{onSubmit:n},{default:()=>[e(y,{label:"名称",required:!0},{default:()=>[e(B,{value:t.value,onUpdateValue:r=>{t.value=r}},null)]}),e("div",{class:"flex justify-end"},[e(D,{class:"rounded-lg",disabled:t.value.length===0,type:"primary",onClick:n,size:"small"},{default:()=>[l("创建")]})])]})}),{data:f,mutate:m}=se("current-disable-status",async()=>{const{data:a}=await A.api.options("authSecurity").get();return a}),d=a=>{A.api.options("authSecurity").patch({data:{disablePasswordLogin:a}}).then(()=>{m()})};return o.props=["dialog"],()=>e("div",{class:"flex flex-col my-4"},[e("div",{class:"flex flex-row items-center justify-between px-16 mt-4"},[e("h1",{class:"text-2xl font-bold felx flex-row"},[l("Passkey"),e("small",{class:"text-base font-normal ml-8"},[l("管理通行密钥（数字认证凭证如FaceID，Windows Hello等）")])]),e("div",{class:"flex gap-2"},[e(z,{icon:e("i",{class:"icon-[mingcute--certificate-line] size-[16px]"},null),class:"rounded-lg",variant:"secondary",description:"验证",onClick:()=>{re.validate(!0)}},null),e(z,{icon:e("i",{class:"icon-[mingcute--hashtag-line] size-[16px]"},null),class:"rounded-lg",variant:"primary",description:"创建",onClick:()=>{const a=dialog.create({title:"创建 Passkey",content:()=>e(o,{dialog:a},null)})}},null)])]),e(Z,{class:"!overflow-visible px-16 mt-2"},{default:()=>[e(E,{labelAlign:"left",labelPlacement:"left"},{default:()=>[e(y,{label:"禁止密码登入"},{default:()=>[e(_,{value:f.value?.disablePasswordLogin,onUpdateValue:a=>{s.value?.length||message.error("至少需要一个 Passkey 才能开启这个功能"),d(a)}},null)]}),e("div",{class:"mt-[-1.5rem]"},[e(O,{class:"text-xs",depth:3},{default:()=>[e("span",null,[l("禁用密码登录需要至少开启 Clerk 或者 PassKey 登录的一项")])]})])]}),e(Se,{class:"mt-2",scrollX:Math.max(800,u.contentWidth.value-u.contentInsetWidth.value),remote:!0,bordered:!0,data:s.value,columns:[{key:"name",title:"名称"},{title:"创建时间",key:"created",render({created:a}){return e(q,{time:a},null)}},{title:"操作",key:"id",render({id:a,name:t}){return e(w,null,{default:()=>[e(R,{positiveText:"取消",negativeText:"删除",onNegativeClick:()=>{F(a)}},{trigger:()=>e(D,{quaternary:!0,type:"error"},{default:()=>[l("删除")]}),default:()=>e("span",{class:"max-w-48"},[l('确定要删除 Passkey "'),t,l('"?')])})]})}}]},null)]})])}),Eu=g(()=>()=>e(v,{class:"justify-center !my-4"},{default:()=>[e(c,{span:"6"},{default:()=>[e("h4",{class:"mt-0 text-2xl font-semibold"},[l("双重身份验证")]),e("p",null,[l("启用双重身份认证（2FA），提高帐户安全性")])]}),e(c,{span:"6"},{default:()=>[e("h6",{class:"mt-0 text-lg text-orange-500 "},[l("状态: 敬请期待")]),e("p",{class:"text-sm"},[l("此功能为实验性功能，正在开发中。")]),e("small",{class:"text-muted"},[l("实验性功能")])]})]}));var M=function(u){return u.User="user",u.System="system",u.Security="security",u}(M||{});const ju=g({setup(){const u=We(),s=we(),i=x(u.params.type);return I(()=>u.params.type,F=>{F&&(i.value=F)}),x(null),()=>e(h,null,[e("div",{class:"relative -mt-12 flex w-full grow flex-col"},[e("div",{dir:"ltr","data-orientation":"horizontal",class:"flex flex-row sticky top-16 z-[1] -ml-4 h-[42px] -mt-8 w-[calc(100%+2rem)] bg-white/80 backdrop-blur dark:bg-zinc-900/80 border-b-[0.5px] border-zinc-200 dark:border-neutral-900"},[e("h1",{class:"w-[50px] center flex mr-4 ml-4 font-bold text-[16px]"},[l("设定")])]),e("div",{class:"bg-white dark:bg-[#151515] border-[#eeeeee] border border-solid rounded-md dark:border-neutral-900 flex mt-12"},[e(Ge,{type:"line",animated:!0,class:"lg:w-full w-full enter-x","justify-content":"space-evenly",size:"medium","bar-width":220,value:i.value,onUpdateValue:F=>{s.replace({...u,params:{...u.params,type:F}})}},{default:()=>[e(X,{tab:"基本设置",name:M.User,class:"items-center"},{default:()=>[e(lu,null,null)]}),e(X,{tab:"系统设置",name:M.System,class:"items-center"},{default:()=>[e(pu,null,null)]}),e(X,{tab:"安全设置",name:M.Security,class:"items-center"},{default:()=>[e(mu,null,null)]})]})])])])}});export{ju as default};
