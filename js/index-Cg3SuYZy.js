import{cP as B,cQ as S,cR as F,cS as N,d as c,W as T,b as k,ax as C,R as u,X as E,w as R,o as D,a2 as A,e,n as q,F as M,g as r,aq as j,k as O,i as m,x as P,bZ as V,a0 as K,j as z,B as L}from"./index-DrqTzKeg.js";const Q=new Map([[B,"博文"],[S,"手记"],[F,"速记"],[N,"说说"]]);function p(a){return typeof a=="function"||Object.prototype.toString.call(a)==="[object Object]"&&!P(a)}const X=c({setup(){const a=T(),s=k(!1);C(async()=>{const t=await u.api.subscribe.status.get().then(l=>l.enable);s.value=t});const n=async()=>{await u.api.options("featureList").patch({data:{emailSubscribe:!s.value}}),s.value=!s.value},{loading:f,checkedRowKeys:g,data:y,pager:o,fetchDataFn:d}=E((t,l)=>async(x=a.query.page||1,w=10)=>{const b=await u.api.subscribe.get({params:{page:x,size:w,sortBy:"created",sortOrder:"-1"}});t.value=b.data,l.value=b.pagination}),i=d;R(()=>a.query.page,async t=>{await i(t)}),D(async()=>{await d()});const h=A(()=>[{title:"邮箱",key:"email",ellipsis:{tooltip:!0},width:140},{title:"订阅内容",key:"subscribe",width:250,render(t){return e(U,{bit:t.subscribe},null)}},{title:"创建于",width:250,key:"created",sortOrder:"descend",render(t){return e(K,{time:t.created},null)}},{title:"操作",fixed:"right",width:40,key:"id",render(t){return e(m,null,{default:()=>[e(z,{positiveText:"取消",negativeText:"删除",onNegativeClick:async()=>{await u.api.subscribe.unsubscribe.get({params:{email:t.email,cancelToken:t.cancelToken}}),message.success("删除成功"),await i(o.value.currentPage)}},{trigger:()=>e(L,{quaternary:!0,type:"error",size:"tiny"},{default:()=>[r("移除")]}),default:()=>e("span",{class:"max-w-48"},[r("确定要删除 "),t.title,r("？")])})]})}}]),v=c(()=>()=>e("div",{class:"inline-flex items-center"},[e("span",null,[r("邮件订阅开启状态：")]),e(V,{value:s.value,onChange:n},null)]));return()=>e("div",{class:"relative -mt-12 flex w-full grow flex-col"},[e("div",{class:"mt-[5rem] p-12 pt-[6px]"},[e(q,{class:"rounded-md border border-solid border-border",contentStyle:"padding:0;"},{header(){return e(M,null,[e("div",{class:"flex flex-col mb-4 select-none"},[e("h1",{class:"flex items-center text-[1.73rem]"},[r("管理订阅")]),e("h2",{class:"opacity-80 text-sm inline-flex mt-2"},[e(v,null,null)])])])},default(){return e(j,{class:"mb-4 custom-ef-np custom-ef-ndt",data:y,loading:f.value,columns:h.value,onFetchData:i,pager:o,onUpdateCheckedRowKeys:t=>{g.value=t}},null)}})])])}}),U=c({props:{bit:{type:Number,required:!0}},render(){const a=[];for(const[s,n]of Q.entries())s&this.bit&&a.push(e(O,{round:!0},p(n)?n:{default:()=>[n]}));return e(m,null,p(a)?a:{default:()=>[a]})}});export{U as SubscribeBit,X as default};
