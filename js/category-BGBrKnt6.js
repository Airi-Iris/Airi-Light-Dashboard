import{d as T,u as j,a as q,r as b,b as p,c as z,o as I,R as c,w as D,e,f as O,g as s,N,h as C,t as A,i as x,B as d,j as M,k as V,l as H,O as L,m as P,F as U,n as _,p as $,q as B,s as F,v as G,x as J}from"./index-DrqTzKeg.js";import{N as K}from"./Badge-BlAq4jeW.js";function Q(u){return typeof u=="function"||Object.prototype.toString.call(u)==="[object Object]"&&!J(u)}const Y=T(u=>{const a=j(q),g=b([]),i=p(!0),l=a.fetch,y=z();I(async()=>{i.value=!0,await l(),i.value=!1;const{data:n}=await c.api.categories.get({params:{type:"tag"}});g.push(...n)});const h=p(""),m=b([]);D(()=>h.value,async n=>{if(!n)return;const t=await c.api.categories(n).get({params:{tag:"true"}});m.length=0,m.push(...t.data)});const r=p(!1),S=()=>({name:"",slug:""}),v=p(S());return()=>{let n;return e(U,null,[e("div",{class:"relative"},[e("div",{class:O("flex flex-wrap items-center justify-between pt-4 lg:mb-5")},[e("div",{class:"flex items-center justify-between"},[e("p",{class:"flex items-center text-lg font-medium"},[e("span",null,[s("文稿 · 分类 / 标签")])])])]),e("div",{class:"pt-[6px]"},[e(N,{prefix:"bar",class:"text-zinc-600"},{default:()=>[s("分类")]}),e(E,{show:r,onSubmit:async t=>{const{name:o,slug:k}=t,w=typeof r.value=="string"?r.value:null;if(w){await c.api.categories(w).put({data:{name:o,slug:k,type:0}}),y.success("修改成功");const f=a.data.value.findIndex(R=>R.id==w);a.data.value[f]={...a.data.value[f],...t}}else{const f=await c.api.categories.post({data:{name:o,slug:k}});y.success("创建成功"),a.data.value.push(f.data)}},initialState:v.value},null),e(C,{rowClassName:()=>A,bordered:!1,data:a.data.value||[],remote:!0,loading:i.value,columns:[{title:"名称",key:"name",width:100},{title:"文章数",key:"count",width:100},{title:"路径",key:"slug",width:180},{width:100,title:"操作",fixed:"right",key:"id",render(t){return e(x,{size:12},{default:()=>[e(d,{size:"tiny",quaternary:!0,type:"primary",onClick:o=>{v.value={name:t.name,slug:t.slug},r.value=t.id}},{default:()=>[s("编辑")]}),e(M,{positiveText:"取消",negativeText:"删除",onNegativeClick:async()=>{await c.api.categories(t.id).delete(),y.success("删除成功"),await a.fetch(!0)}},{trigger:()=>e(d,{quaternary:!0,type:"error",size:"tiny"},{default:()=>[s("移除")]}),default:()=>e("span",{class:"max-w-48"},[s("确定要删除 "),t.title,s(" ?")])})]})}}]},null),e(N,{prefix:"bar",class:"text-zinc-600"},{default:()=>[s("标签")]}),e(x,{size:12},Q(n=g.map(t=>e(K,{value:t.count,key:t.name},{default:()=>[e(V,{class:"border border-gray-200 rounded-md",type:"primary",checkable:!0,bordered:!0,round:!0,checked:h.value==t.name,onUpdateChecked:o=>{o&&(h.value=t.name)}},{default:()=>[t.name]})]})))?n:{default:()=>[n]}),m.length!=0&&e(C,{remote:!0,class:"mt-4",data:m,columns:[{title:"标题",key:"title",render(t){return e(H,{to:`/posts/edit?id=${t.id}`},{default:()=>[e(d,{type:"primary",quaternary:!0},{default:()=>[t.title]})]})}},{title:"分类",key:"category",render(t){return t.category.name}}]},null)]),e(L,null,{default:()=>[e(P,{className:"bg-accent",name:"添加分类/标签",onClick:()=>{r.value=!0,v.value=S()},icon:e("i",{class:"icon-[mingcute--add-line] text-white"},null)},null)]})])])}}),E=T(u=>{const a=b(u.initialState??{name:"",slug:""});D(()=>u.initialState,l=>{l&&(a.name=l.name,a.slug=l.slug)});const g=z(),i=()=>{if(!a.name||!a.slug){g.error("名字 和 路径 不能为空");return}u.onSubmit(a),u.show.value=!1};return()=>e(G,{transformOrigin:"center",show:!!u.show.value,onUpdateShow:l=>{u.show.value=l}},{default:()=>e(_,{style:"width: 500px;max-width: 90vw",headerStyle:{textAlign:"center"},title:u.initialState?"编辑":"新建"},{default:()=>[e($,{onSubmit:i,model:a,rules:{name:{required:!0,trigger:["input","blur"]},slug:{required:!0,trigger:["input","blur"]}}},{default:()=>[e(B,{path:"name",label:"名字"},{default:()=>[e(F,{placeholder:"",onInput:l=>{a.name=l},value:a.name},null)]}),e(B,{path:"slug",label:"路径"},{default:()=>[e(F,{placeholder:"",onInput:l=>{a.slug=l},value:a.slug},null)]}),e("div",{class:"text-center"},[e(x,{size:12,align:"center",inline:!0},{default:()=>[e(d,{type:"primary",onClick:i,round:!0},{default:()=>[s("确定")]}),e(d,{onClick:()=>u.show.value=!1,round:!0},{default:()=>[s("取消")]})]})])]})]})})});E.props=["initialState","onSubmit","show"];export{Y as CategoryView};
